<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1014px" preserveAspectRatio="none" style="width:1610px;height:1014px;background:#FFFFFF;" version="1.1" viewBox="0 0 1610 1014" width="1610px" zoomAndPan="magnify"><defs><filter height="300%" id="fsrxe89oe27f5" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="666" x="474.75" y="28.708">Auto-Populate Business and Postal Address from NZBI API or AddressFinder</text><rect fill="#DDDDDD" height="967.3125" style="stroke:#A80036;stroke-width:1.0;" width="247" x="222" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="241" x="225" y="53.02">kiwibank Loan Application Client</text><rect fill="#FFFAFA" height="967.3125" style="stroke:#A80036;stroke-width:1.0;" width="239" x="778.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="200" x="795.5" y="53.02">external address providers</text><rect fill="#90EE90" height="967.3125" style="stroke:#A80036;stroke-width:1.0;" width="344" x="1039.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="249" x="1084.5" y="53.02">kiwibank loan application domain</text><rect fill="#DDDDDD" height="967.3125" style="stroke:#A80036;stroke-width:1.0;" width="199" x="1405.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="113" x="1448.5" y="53.02">kiwibank kafka</text><rect fill="#FFFFFF" filter="url(#fsrxe89oe27f5)" height="749.5859" style="stroke:#A80036;stroke-width:1.0;" width="10" x="340.5" y="154.3828"/><rect fill="#FFFFFF" filter="url(#fsrxe89oe27f5)" height="351.8594" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1114.5" y="561.1094"/><rect fill="#FFFFFF" filter="url(#fsrxe89oe27f5)" height="175.7969" style="stroke:#000000;stroke-width:2.0;" width="1013.5" x="10" y="357.1797"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="56" x2="56" y1="123.25" y2="921.9688"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="345.5" x2="345.5" y1="123.25" y2="921.9688"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="820.5" x2="820.5" y1="123.25" y2="921.9688"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="941.5" x2="941.5" y1="123.25" y2="921.9688"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1119.5" x2="1119.5" y1="123.25" y2="921.9688"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1310.5" x2="1310.5" y1="123.25" y2="921.9688"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1504.5" x2="1504.5" y1="123.25" y2="921.9688"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="20" y="119.9482">customer</text><ellipse cx="56" cy="49.9531" fill="#FEFECE" filter="url(#fsrxe89oe27f5)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M56,57.9531 L56,84.9531 M43,65.9531 L69,65.9531 M56,84.9531 L43,99.9531 M56,84.9531 L69,99.9531 " fill="none" filter="url(#fsrxe89oe27f5)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="20" y="933.9639">customer</text><ellipse cx="56" cy="947.2656" fill="#FEFECE" filter="url(#fsrxe89oe27f5)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M56,955.2656 L56,982.2656 M43,963.2656 L69,963.2656 M56,982.2656 L43,997.2656 M56,982.2656 L69,997.2656 " fill="none" filter="url(#fsrxe89oe27f5)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#fsrxe89oe27f5)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="154" x="266.5" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140" x="273.5" y="107.9482">loan_application.app</text><rect fill="#FEFECE" filter="url(#fsrxe89oe27f5)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="154" x="266.5" y="920.9688"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140" x="273.5" y="940.9639">loan_application.app</text><rect fill="#FEFECE" filter="url(#fsrxe89oe27f5)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="73" x="782.5" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="789.5" y="107.9482">nzbn.api</text><rect fill="#FEFECE" filter="url(#fsrxe89oe27f5)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="73" x="782.5" y="920.9688"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="789.5" y="940.9639">nzbn.api</text><rect fill="#FEFECE" filter="url(#fsrxe89oe27f5)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="140" x="869.5" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="876.5" y="107.9482">address_finder.api</text><rect fill="#FEFECE" filter="url(#fsrxe89oe27f5)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="140" x="869.5" y="920.9688"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="876.5" y="940.9639">address_finder.api</text><rect fill="#FEFECE" filter="url(#fsrxe89oe27f5)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="148" x="1043.5" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="134" x="1050.5" y="107.9482">loan_application.api</text><rect fill="#FEFECE" filter="url(#fsrxe89oe27f5)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="148" x="1043.5" y="920.9688"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="134" x="1050.5" y="940.9639">loan_application.api</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132" x="1241.5" y="119.9482">loan_application.db</text><path d="M1292.5,70.9531 C1292.5,60.9531 1310.5,60.9531 1310.5,60.9531 C1310.5,60.9531 1328.5,60.9531 1328.5,70.9531 L1328.5,96.9531 C1328.5,106.9531 1310.5,106.9531 1310.5,106.9531 C1310.5,106.9531 1292.5,106.9531 1292.5,96.9531 L1292.5,70.9531 " fill="#FEFECE" filter="url(#fsrxe89oe27f5)" style="stroke:#000000;stroke-width:1.5;"/><path d="M1292.5,70.9531 C1292.5,80.9531 1310.5,80.9531 1310.5,80.9531 C1310.5,80.9531 1328.5,80.9531 1328.5,70.9531 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132" x="1241.5" y="933.9639">loan_application.db</text><path d="M1292.5,947.2656 C1292.5,937.2656 1310.5,937.2656 1310.5,937.2656 C1310.5,937.2656 1328.5,937.2656 1328.5,947.2656 L1328.5,973.2656 C1328.5,983.2656 1310.5,983.2656 1310.5,983.2656 C1310.5,983.2656 1292.5,983.2656 1292.5,973.2656 L1292.5,947.2656 " fill="#FEFECE" filter="url(#fsrxe89oe27f5)" style="stroke:#000000;stroke-width:1.5;"/><path d="M1292.5,947.2656 C1292.5,957.2656 1310.5,957.2656 1310.5,957.2656 C1310.5,957.2656 1328.5,957.2656 1328.5,947.2656 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><path d="M1414.5,80.6563 L1595.5,80.6563 C1600.5,80.6563 1600.5,101.9531 1600.5,101.9531 C1600.5,101.9531 1600.5,123.25 1595.5,123.25 L1414.5,123.25 C1409.5,123.25 1409.5,101.9531 1409.5,101.9531 C1409.5,101.9531 1409.5,80.6563 1414.5,80.6563 " fill="#FEFECE" filter="url(#fsrxe89oe27f5)" style="stroke:#A80036;stroke-width:2.0;"/><path d="M1595.5,80.6563 C1590.5,80.6563 1590.5,101.9531 1590.5,101.9531 C1590.5,123.25 1595.5,123.25 1595.5,123.25 " fill="none" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="52" x="1474" y="98.6514">«topic»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="171" x="1414.5" y="114.9482">loan.unsecured.v1.event</text><path d="M1414.5,920.9688 L1595.5,920.9688 C1600.5,920.9688 1600.5,942.2656 1600.5,942.2656 C1600.5,942.2656 1600.5,963.5625 1595.5,963.5625 L1414.5,963.5625 C1409.5,963.5625 1409.5,942.2656 1409.5,942.2656 C1409.5,942.2656 1409.5,920.9688 1414.5,920.9688 " fill="#FEFECE" filter="url(#fsrxe89oe27f5)" style="stroke:#A80036;stroke-width:2.0;"/><path d="M1595.5,920.9688 C1590.5,920.9688 1590.5,942.2656 1590.5,942.2656 C1590.5,963.5625 1595.5,963.5625 1595.5,963.5625 " fill="none" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="52" x="1474" y="938.9639">«topic»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="171" x="1414.5" y="955.2607">loan.unsecured.v1.event</text><rect fill="#FFFFFF" filter="url(#fsrxe89oe27f5)" height="749.5859" style="stroke:#A80036;stroke-width:1.0;" width="10" x="340.5" y="154.3828"/><rect fill="#FFFFFF" filter="url(#fsrxe89oe27f5)" height="351.8594" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1114.5" y="561.1094"/><polygon fill="#A80036" points="328.5,150.3828,338.5,154.3828,328.5,158.3828,332.5,154.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="56" x2="334.5" y1="154.3828" y2="154.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="63" y="149.3169">input business name</text><polygon fill="#A80036" points="809,179.5156,819,183.5156,809,187.5156,813,183.5156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="350.5" x2="815" y1="183.5156" y2="183.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="406" x="357.5" y="178.4497">GET /services/v4a/nzbn/entities?search-term={businessName}</text><polygon fill="#A80036" points="361.5,208.6484,351.5,212.6484,361.5,216.6484,357.5,212.6484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="355.5" x2="820" y1="212.6484" y2="212.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="367.5" y="207.5825">200 [searchResults]</text><polygon fill="#A80036" points="328.5,237.7813,338.5,241.7813,328.5,245.7813,332.5,241.7813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="56" x2="334.5" y1="241.7813" y2="241.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="63" y="236.7153">select business name from results</text><polygon fill="#A80036" points="809,266.9141,819,270.9141,809,274.9141,813,270.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="350.5" x2="815" y1="270.9141" y2="270.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260" x="357.5" y="265.8481">GET /services/v4a/nzbn/entities/{nzbnId}</text><polygon fill="#A80036" points="361.5,296.0469,351.5,300.0469,361.5,304.0469,357.5,300.0469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="355.5" x2="820" y1="300.0469" y2="300.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="367.5" y="294.981">200 [NZBN Entity]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="350.5" x2="392.5" y1="329.1797" y2="329.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="392.5" x2="392.5" y1="329.1797" y2="342.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="351.5" x2="392.5" y1="342.1797" y2="342.1797"/><polygon fill="#A80036" points="361.5,338.1797,351.5,342.1797,361.5,346.1797,357.5,342.1797" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="357.5" y="324.1138">populate Business Address</text><path d="M10,357.1797 L74,357.1797 L74,364.1797 L64,374.1797 L10,374.1797 L10,357.1797 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="175.7969" style="stroke:#000000;stroke-width:2.0;" width="1013.5" x="10" y="357.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="25" y="370.2466">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="297" x="89" y="369.3901">[user updated the business or postal address]</text><polygon fill="#A80036" points="328.5,391.4453,338.5,395.4453,328.5,399.4453,332.5,395.4453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="56" x2="334.5" y1="395.4453" y2="395.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="63" y="390.3794">input address</text><polygon fill="#A80036" points="929.5,420.5781,939.5,424.5781,929.5,428.5781,933.5,424.5781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="350.5" x2="935.5" y1="424.5781" y2="424.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="321" x="357.5" y="419.5122">GET /address/autocomplete/q={inputtedAddress}</text><polygon fill="#A80036" points="361.5,449.7109,351.5,453.7109,361.5,457.7109,357.5,453.7109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="355.5" x2="940.5" y1="453.7109" y2="453.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="367.5" y="448.645">200 [completions]</text><polygon fill="#A80036" points="328.5,478.8438,338.5,482.8438,328.5,486.8438,332.5,482.8438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="56" x2="334.5" y1="482.8438" y2="482.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174" x="63" y="477.7778">select address from results</text><line style="stroke:#A80036;stroke-width:1.0;" x1="350.5" x2="392.5" y1="511.9766" y2="511.9766"/><line style="stroke:#A80036;stroke-width:1.0;" x1="392.5" x2="392.5" y1="511.9766" y2="524.9766"/><line style="stroke:#A80036;stroke-width:1.0;" x1="351.5" x2="392.5" y1="524.9766" y2="524.9766"/><polygon fill="#A80036" points="361.5,520.9766,351.5,524.9766,361.5,528.9766,357.5,524.9766" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="357.5" y="506.9106">populate Business address</text><polygon fill="#A80036" points="328.5,557.1094,338.5,561.1094,328.5,565.1094,332.5,561.1094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="56" x2="334.5" y1="561.1094" y2="561.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="63" y="556.0435">click continue</text><polygon fill="#A80036" points="1102.5,601.375,1112.5,605.375,1102.5,609.375,1106.5,605.375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="350.5" x2="1108.5" y1="605.375" y2="605.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="298" x="357.5" y="585.1763">PUT /api/loan-application/{applicationNumber}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="389.5" y="600.3091">body {loanApplication}</text><path d="M1020,618.375 L1020,673.375 L1215,673.375 L1215,628.375 L1205,618.375 L1020,618.375 " fill="#FBFB77" filter="url(#fsrxe89oe27f5)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1205,618.375 L1205,628.375 L1215,628.375 L1205,618.375 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="1026" y="635.4419">payload contains the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174" x="1026" y="650.5747">Address object as specified</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="1026" y="665.7075">in the class diagram</text><polygon fill="#A80036" points="1298.5,699.9063,1308.5,703.9063,1298.5,707.9063,1302.5,703.9063" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1124.5" x2="1304.5" y1="703.9063" y2="703.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="1131.5" y="698.8403">update {loanApplication}</text><path d="M894,716.9063 L894,786.9063 L1340,786.9063 L1340,726.9063 L1330,716.9063 L894,716.9063 " fill="#FBFB77" filter="url(#fsrxe89oe27f5)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1330,716.9063 L1330,726.9063 L1340,726.9063 L1330,716.9063 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="292" x="900" y="733.9731">Use an Enterprise.Shared Address interpreter</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="296" x="900" y="749.106">to EDM-ify the address. Assuming at this point</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="266" x="900" y="764.2388">the loanApplication.Address.AddressBody</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="425" x="900" y="779.3716">is enough to create an EDM Address, no external API calls needed.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1124.5" x2="1166.5" y1="832.7031" y2="832.7031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1166.5" x2="1166.5" y1="832.7031" y2="845.7031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1125.5" x2="1166.5" y1="845.7031" y2="845.7031"/><polygon fill="#A80036" points="1135.5,841.7031,1125.5,845.7031,1135.5,849.7031,1131.5,845.7031" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="1131.5" y="812.5044">convert Address</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="1131.5" y="827.6372">to EDM Address</text><polygon fill="#A80036" points="1493,870.8359,1503,874.8359,1493,878.8359,1497,874.8359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1124.5" x2="1499" y1="874.8359" y2="874.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="1131.5" y="869.77">publish loanApplicationUpdated</text><polygon fill="#A80036" points="356.5,899.9688,346.5,903.9688,356.5,907.9688,352.5,903.9688" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="350.5" x2="1113.5" y1="903.9688" y2="903.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="362.5" y="898.9028">200 {loanApplication}</text><!--MD5=[94c0c62f9bd4f2d87c3b5f27031113e7]
@startuml
skinparam BoxPadding 10

title Auto-Populate Business and Postal Address from NZBI API or AddressFinder

actor customer

box kiwibank Loan Application Client
  participant loan_application.app
end box

box external address providers #Snow
  participant nzbn.api  
  
  participant address_finder.api
end box

box kiwibank loan application domain #LightGreen
  participant loan_application.api  
  
  database loan_application.db
  
end box

box kiwibank kafka
queue loan.unsecured.v1.event <<topic>>
end box

customer -> loan_application.app : input business name
activate  loan_application.app
  loan_application.app -> nzbn.api : GET /services/v4a/nzbn/entities?search-term={businessName}
  
  nzbn.api - -> loan_application.app : 200 [searchResults]

  customer -> loan_application.app : select business name from results

  loan_application.app -> nzbn.api : GET /services/v4a/nzbn/entities/{nzbnId}

  nzbn.api - -> loan_application.app : 200 [NZBN Entity]

  loan_application.app -> loan_application.app : populate Business Address
  
  alt user updated the business or postal address
    customer -> loan_application.app : input address
    loan_application.app -> address_finder.api : GET /address/autocomplete/q={inputtedAddress}
    address_finder.api - -> loan_application.app : 200 [completions]
    customer -> loan_application.app : select address from results
    loan_application.app -> loan_application.app : populate Business address
  end

  customer -> loan_application.app : click continue
  activate loan_application.api
    loan_application.app -> loan_application.api : PUT /api/loan-application/{applicationNumber}\n\tbody {loanApplication}
    note over loan_application.api : payload contains the\nAddress object as specified\nin the class diagram
    loan_application.api -> loan_application.db : update {loanApplication}

    note over loan_application.api
      Use an Enterprise.Shared Address interpreter
      to EDM-ify the address. Assuming at this point
      the loanApplication.Address.AddressBody
      is enough to create an EDM Address, no external API calls needed.
    end note
    loan_application.api -> loan_application.api : convert Address\nto EDM Address
    loan_application.api -> loan.unsecured.v1.event : publish loanApplicationUpdated
    loan_application.api - -> loan_application.app : 200 {loanApplication}
  deactivate loan_application.app

deactivate loan_application.app
@enduml

PlantUML version 1.2021.7(Sun May 23 12:40:07 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>